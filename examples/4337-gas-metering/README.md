# 4337 Gas Metering Analysis

## How to run?

1. Rename the `.env.example` to `.env`.
2. Fill the required values of `.env`.
3. Based on which paymaster to run, check the `package.json` file to see the `script`. Furthermore, you can check the `README.md` files in the corresponding paymaster folders to see the individual command and their possible results.

NOTE: If you run a paymaster analysis twice or more without changing the salt for Safe Creation, then only the operation will execute through paymaster (if any), rather than Safe Creation and Operation.

## Gas Usage Results

|                                                                  | **With 4337?** | **Account Creation**                                                                                                                                                                                                                                  | **Account Creation + Native Transfer**                                                                                                                                                                                                                | **Native Transfer**                                                                                                                                                                                                                                   | **Account Creation + ERC20 Transfer**                                                                                                                                                                                                                 | **ERC20 Transfer**                                                                                                                                                                                                                                    | **Account Creation + ERC721 Minting**                                                                                                                                                                                                                 | **ERC721 Minting**                                                                                                                                                                                                                                    |
| ---------------------------------------------------------------- | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **[Without Paymaster](../../modules/4337/test/gas/Gas.spec.ts)** | Yes            | 415213                                                                                                                                                                                                                                                | 447632                                                                                                                                                                                                                                                | 182081                                                                                                                                                                                                                                                | 426139                                                                                                                                                                                                                                                | 160575                                                                                                                                                                                                                                                | 467926                                                                                                                                                                                                                                                | 202374                                                                                                                                                                                                                                                |
| **Gelato (4337 Compatible - 1Balance)**                          | No             | 302679 ([TX](https://sepolia.basescan.org/tx/0x1b2f743dff63dfc6e01e18623cb8d692d4a1cf206008358fac3eaf8fd5957c91)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0x1b2f743dff63dfc6e01e18623cb8d692d4a1cf206008358fac3eaf8fd5957c91/gas-usage)) | 313228 ([TX](https://sepolia.basescan.org/tx/0xddbd655b8a11cf043c535c2d6dbe14aa82925d444a0d4bb5378670993ad1862c)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xddbd655b8a11cf043c535c2d6dbe14aa82925d444a0d4bb5378670993ad1862c/gas-usage)) | 83930 ([TX](https://sepolia.basescan.org/tx/0x162b8817fe9cbbccb905c4b51cc25cbf2625afa1e5341087a4e79b9bb6834fc6)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0x162b8817fe9cbbccb905c4b51cc25cbf2625afa1e5341087a4e79b9bb6834fc6/gas-usage))  | 315961 ([TX](https://sepolia.basescan.org/tx/0x1043acb58c89667d26360f23532d6eee4ab927b20ba37035fb3ffb8cc71c224b)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0x1043acb58c89667d26360f23532d6eee4ab927b20ba37035fb3ffb8cc71c224b/gas-usage)) | 86852 ([TX](https://sepolia.basescan.org/tx/0x6c6ccadea5e54aa47b36c603132b315f1cf15e75e96c0376a7c76ae48f69a006)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0x6c6ccadea5e54aa47b36c603132b315f1cf15e75e96c0376a7c76ae48f69a006/gas-usage))  | 345284 ([TX](https://sepolia.basescan.org/tx/0xd49b482ff37f07f12fc1688a2af33b4451d63409fe547f9cf2e660422866da3e)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xd49b482ff37f07f12fc1688a2af33b4451d63409fe547f9cf2e660422866da3e/gas-usage)) | 116159 ([TX](https://sepolia.basescan.org/tx/0x5814be99c937b6e7386f3526fe9f11fc1bf7a21180daf66ee2e44cc1e4d0da3d)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0x5814be99c937b6e7386f3526fe9f11fc1bf7a21180daf66ee2e44cc1e4d0da3d/gas-usage)) |
| **Pimlico - EntryPoint v0.7 (Base Sepolia - ERC20 Paymaster)**   | Yes            | 487605 ([TX](https://sepolia.basescan.org/tx/0xc44f5d2f26a71663f15f0c257bc557707179161578508c2c9a1095b53a69daa7)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xc44f5d2f26a71663f15f0c257bc557707179161578508c2c9a1095b53a69daa7/gas-usage)) | 494988 ([TX](https://sepolia.basescan.org/tx/0xcbd6cbce4bb5ca257968fc583b401b66a6d4658ed75e5eabecc895db1305e647)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xcbd6cbce4bb5ca257968fc583b401b66a6d4658ed75e5eabecc895db1305e647/gas-usage)) | 182388 ([TX](https://sepolia.basescan.org/tx/0xae8555a827966d28414a1110ac73ced970115a2e3c5a7400490b8fbc9dc42624)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xae8555a827966d28414a1110ac73ced970115a2e3c5a7400490b8fbc9dc42624/gas-usage)) | 514156 ([TX](https://sepolia.basescan.org/tx/0x8302c8a2f381067855091c97d091bcfc566e4112a33e65b34fbfadb5c5318c66)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0x8302c8a2f381067855091c97d091bcfc566e4112a33e65b34fbfadb5c5318c66/gas-usage)) | 185479 ([TX](https://sepolia.basescan.org/tx/0xa1b9fc3edefc8cf824b37151d55aa0e7319ab8f8c3e2affd1aba4d19efba3a91)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xa1b9fc3edefc8cf824b37151d55aa0e7319ab8f8c3e2affd1aba4d19efba3a91/gas-usage)) | 527408 ([TX](https://sepolia.basescan.org/tx/0xfca26170369c63b0c4c6abcb4bcb569376e180310a4f2c4b37dbf3b6de2a9fd5)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xfca26170369c63b0c4c6abcb4bcb569376e180310a4f2c4b37dbf3b6de2a9fd5/gas-usage)) | 214759 ([TX](https://sepolia.basescan.org/tx/0xe5a0e1aa8f714e354730344b1110f0225993d6885d68d7b9c8e309da800190a1)) ([Gas](https://dashboard.tenderly.co/tx/base-sepolia/0xe5a0e1aa8f714e354730344b1110f0225993d6885d68d7b9c8e309da800190a1/gas-usage)) |
| **Pimlico - EntryPoint v0.7 (Sepolia - Verifying Paymaster)**    | Yes            | 396009 ([TX](https://sepolia.etherscan.io/tx/0x5a9119d67f76203ebfbdb641d7620d41242502cffa4a10b801a79a463ef60893)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x5a9119d67f76203ebfbdb641d7620d41242502cffa4a10b801a79a463ef60893/gas-usage)       | 403404 ([TX](https://sepolia.etherscan.io/tx/0x9c92c03c6f6abee15c8b7857d1dfa0d3aec517b7d116ae6f8b1034e192667a75)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x9c92c03c6f6abee15c8b7857d1dfa0d3aec517b7d116ae6f8b1034e192667a75/gas-usage))      | 120355 ([TX](https://sepolia.etherscan.io/tx/0xb01f64d8db284a6f05fa7083a242bb238f44a70e49a55d6046e99c2f9029dc3f)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xb01f64d8db284a6f05fa7083a242bb238f44a70e49a55d6046e99c2f9029dc3f/gas-usage))      | 423670 ([TX](https://sepolia.etherscan.io/tx/0x2c23f209eb25208bb977fb81992dbc072201ab8d4d7dd2a2c527558c6d22a6b6)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x2c23f209eb25208bb977fb81992dbc072201ab8d4d7dd2a2c527558c6d22a6b6/gas-usage))      | 123494 ([TX](https://sepolia.etherscan.io/tx/0x556a93d3481866744217adacc930c05544293053068ce3bba81d6af81b18d12e)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x556a93d3481866744217adacc930c05544293053068ce3bba81d6af81b18d12e/gas-usage))      | 452929 ([TX](https://sepolia.etherscan.io/tx/0x45ee84ab39fed43d2d2399aaa3e9aa9ebe2a65691d80d4e169b0c6efd21ec3cb)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x45ee84ab39fed43d2d2399aaa3e9aa9ebe2a65691d80d4e169b0c6efd21ec3cb/gas-usage))      | 152766 ([TX](https://sepolia.etherscan.io/tx/0x22b94bd700109d5d46b5f1da1414e5c582cc1bedc9418371d24e320bfc0d44eb)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x22b94bd700109d5d46b5f1da1414e5c582cc1bedc9418371d24e320bfc0d44eb/gas-usage))      |
| **Alchemy - EntryPoint v0.6 (ETH from Safe)**                    | Yes            | 417074 ([TX](https://sepolia.etherscan.io/tx/0x03c507f5dc14c6b6af04c5ad722f0650d86925837d9889e4972cb087e34d7b88)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x03c507f5dc14c6b6af04c5ad722f0650d86925837d9889e4972cb087e34d7b88/gas-usage))      | 424505 ([TX](https://sepolia.etherscan.io/tx/0x0263331d8d4568c08d4a700385c08062ee0342fe6f65b2c7eb1a194ddec23ec2)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x0263331d8d4568c08d4a700385c08062ee0342fe6f65b2c7eb1a194ddec23ec2/gas-usage))      | 107057 ([TX](https://sepolia.etherscan.io/tx/0xf4e38d9f3535dcb9519ca3527734a5ea611a0d1bafb632051736537853eb502b)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xf4e38d9f3535dcb9519ca3527734a5ea611a0d1bafb632051736537853eb502b/gas-usage))      | 427599 ([TX](https://sepolia.etherscan.io/tx/0x794b02531f14b6c432c0dcf08d1cb76a8693dd75b35c5dde0d4547754d208143)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x794b02531f14b6c432c0dcf08d1cb76a8693dd75b35c5dde0d4547754d208143/gas-usage))      | 110174 ([TX](https://sepolia.etherscan.io/tx/0xb56985ee07b1e7931aedc387698620d890c99992c4c688b8b3a150f355089e5d)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xb56985ee07b1e7931aedc387698620d890c99992c4c688b8b3a150f355089e5d/gas-usage))      | 456870 ([TX](https://sepolia.etherscan.io/tx/0x2d2a0c8215821f0aa9cf8f88175aa8256cdca1a2928f2aa667916e5127f5dcb6)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x2d2a0c8215821f0aa9cf8f88175aa8256cdca1a2928f2aa667916e5127f5dcb6/gas-usage))      | 139420 ([TX](https://sepolia.etherscan.io/tx/0x178d2c16a261dcb49e810bf39ce35cf96cbab8c7d3235709c7164ba6193c716e)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x178d2c16a261dcb49e810bf39ce35cf96cbab8c7d3235709c7164ba6193c716e/gas-usage))      |
| **Alchemy - EntryPoint v0.6 (ETH - Gas Policy)**                 | Yes            | 411372 ([TX](https://sepolia.etherscan.io/tx/0xcbb2c3c49b9d72d9ecf692308d69a8ad797ab5b1c6603f4fad989f966d692af1)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xcbb2c3c49b9d72d9ecf692308d69a8ad797ab5b1c6603f4fad989f966d692af1/gas-usage))      | 418779 ([TX](https://sepolia.etherscan.io/tx/0x49fbedf833cfecf9db7de56c61d4227292723115520600dbc3711da5e6a85672)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x49fbedf833cfecf9db7de56c61d4227292723115520600dbc3711da5e6a85672/gas-usage))      | 130202 ([TX](https://sepolia.etherscan.io/tx/0x35f1e5b04d988e4614a17609190b3e21b0a9892f78da9f400248cfb3b5afde9a)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x35f1e5b04d988e4614a17609190b3e21b0a9892f78da9f400248cfb3b5afde9a/gas-usage))      | 421926 ([TX](https://sepolia.etherscan.io/tx/0x7dda913ae986d49c4322f414102ae374441a40adb4b33727e568ba140904d52a)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0x7dda913ae986d49c4322f414102ae374441a40adb4b33727e568ba140904d52a/gas-usage))      | 133394 ([TX](https://sepolia.etherscan.io/tx/0xe34902ebd5377cac04c47d142f6ca2de558df63a7e0c6541f704df651b7cfcb1)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xe34902ebd5377cac04c47d142f6ca2de558df63a7e0c6541f704df651b7cfcb1/gas-usage))      | 451200 ([TX](https://sepolia.etherscan.io/tx/0xb1253508bc4ca5ce41222b15b0e7bf03b2273bcb09d93e1d6d6a5ea39b43ee84)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xb1253508bc4ca5ce41222b15b0e7bf03b2273bcb09d93e1d6d6a5ea39b43ee84/gas-usage))      | 162654 ([TX](https://sepolia.etherscan.io/tx/0xd13fb70626a26aaa02e0389cd9347c1c0d8d8ed9ee794a61c5d3eea4b36e239a)) ([Gas](https://dashboard.tenderly.co/tx/sepolia/0xd13fb70626a26aaa02e0389cd9347c1c0d8d8ed9ee794a61c5d3eea4b36e239a/gas-usage))      |

## Detailed Individual Gas Usage Results

### Pimlico - EntryPoint v0.7 (Base Sepolia ERC20 Paymaster)

| Type                               | Actual Gas | handleOps | \_createSenderIfNeeded       | Safe Proxy Factory | ValidateUserOp (Safe) | \_executeUserOp | executeUserOp (Safe) | execTransactionFromModule |
| ---------------------------------- | ---------- | --------- | ---------------------------- | ------------------ | --------------------- | --------------- | -------------------- | ------------------------- |
| Account Creation                   | 487605     | 456569    | Wasn't included in the trace | 295395             | 11856                 | 24381           | 6424                 | 4411                      |
| Account Creation + Native Transfer | 494988     | 463940    | Wasn't included in the trace | 295395             | 11856                 | 31752           | 13795                | 11782                     |
| Native Transfer                    | 182388     | 158296    | NA                           | NA                 | 15536                 | 33798           | 15795                | 13782                     |
| Account Creation + ERC20 Transfer  | 498115     | 471111    | Wasn't included in the trace | 295395             | 11883                 | 38804           | 20784                | 18528                     |
| ERC20 Transfer                     | 185479     | 165467    | NA                           | NA                 | 15536                 | 40850           | 22784                | 20528                     |
| Account Creation + ERC721 Minting  | 527408     | 495792    | Wasn't included in the trace | 295395             | 11874                 | 63524           | 45525                | 43351                     |
| ERC721 Minting                     | 214759     | 190147    | NA                           | NA                 | 15554                 | 65570           | 47525                | 45351                     |

### Pimlico - EntryPoint v0.7 (Sepolia - Verifying Paymaster)

| Type                               | Actual Gas | handleOps | \_createSenderIfNeeded       | Safe Proxy Factory | ValidateUserOp (Safe) | \_executeUserOp | executeUserOp (Safe) | execTransactionFromModule |
| ---------------------------------- | ---------- | --------- | ---------------------------- | ------------------ | --------------------- | --------------- | -------------------- | ------------------------- |
| Account Creation                   | 414071     | 366053    | Wasn't included in the trace | 264042             | 11771                 | 14542           | 6424                 | 4411                      |
| Account Creation + Native Transfer | 421350     | 373424    | Wasn't included in the trace | 264042             | 11771                 | 21913           | 13795                | 11782                     |
| Native Transfer                    | 137723     | 94935     | NA                           | NA                 | 15572                 | 23930           | 15795                | 13782                     |
| Account Creation + ERC20 Transfer  | 446477     | 397746    | Wasn't included in the trace | 264042             | 11798                 | 46088           | 37906                | 35650                     |
| ERC20 Transfer                     | 145721     | 102154    | NA                           | NA                 | 15599                 | 31004           | 22806                | 20550                     |
| Account Creation + ERC721 Minting  | 470905     | 422417    | Wasn't included in the trace | 264042             | 11789                 | 70808           | 62647                | 60473                     |
| ERC721 Minting                     | 170150     | 126826    | NA                           | NA                 | 15590                 | 55724           | 47547                | 45373                     |

### Alchemy - EntryPoint v0.6 (ETH from Safe)

| Type                               | Actual Gas | handleOps | \_createSenderIfNeeded | Safe Proxy Factory | ValidateUserOp (Safe) | \_executeUserOp | executeUserOp (Safe) | execTransactionFromModule |
| ---------------------------------- | ---------- | --------- | ---------------------- | ------------------ | --------------------- | --------------- | -------------------- | ------------------------- |
| Account Creation                   | 417074     | 407850    | 283735                 | 267761             | 47159                 | 34826           | 7015                 | 4411                      |
| Account Creation + Native Transfer | 424505     | 415221    | 283735                 | 267761             | 47159                 | 42197           | 14386                | 13795                     |
| Native Transfer                    | 107057     | 83301     | NA                     | NA                 | 20512                 | 24297           | 16386                | 15795                     |
| Account Creation + ERC20 Transfer  | 427599     | 422407    | 283754                 | 267761             | 47205                 | 49272           | 21415                | 20806                     |
| ERC20 Transfer                     | 110174     | 90486     | NA                     | NA                 | 20558                 | 31372           | 23415                | 20550                     |
| Account Creation + ERC721 Minting  | 456870     | 447090    | 283748                 | 267761             | 47190                 | 73991           | 46150                | 43373                     |
| ERC721 Minting                     | 139420     | 115168    | NA                     | NA                 | 20542                 | 56091           | 48150                | 45373                     |

### Alchemy - EntryPoint v0.6 (ETH - Gas Policy)

| Type                               | Actual Gas | handleOps | \_createSenderIfNeeded | Safe Proxy Factory | ValidateUserOp (Safe) | \_executeUserOp | executeUserOp (Safe) | execTransactionFromModule |
| ---------------------------------- | ---------- | --------- | ---------------------- | ------------------ | --------------------- | --------------- | -------------------- | ------------------------- |
| Account Creation                   | 411372     | 380632    | 281451                 | 267761             | 14992                 | 14932           | 7015                 | 4411                      |
| Account Creation + Native Transfer | 418779     | 388003    | 281451                 | 14992              | 22303                 | 14386           | 11782                |                           |
| Native Transfer                    | 130202     | 104878    | NA                     | NA                 | 15320                 | 24310           | 16386                | 15795                     |
| Account Creation + ERC20 Transfer  | 421926     | 395254    | 281471                 | 15038              | 29378                 | 21415           | 20806                | 18550                     |
| ERC20 Transfer                     | 133394     | 112126    | NA                     | NA                 | 20618                 | 31385           | 23415                | 20550                     |
| Account Creation + ERC721 Minting  | 451200     | 419916    | 281464                 | 15023              | 54097                 | 46150           |                      | 43373                     |
| ERC721 Minting                     | 162654     | 136786    | NA                     | NA                 | 20603                 | 56103           | 48150                | 45373                     |
